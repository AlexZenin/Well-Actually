/* v3: Inline Errors, Placeholders, Mailcheck, Form Engagement, Page Overlay, Gender Radio Buttons */
var ehcorp = window.ehcorp || {};ehcorp = ehcorp || {};
/* Modernizr 2.6.2 (Custom Build) | MIT & BSD * Build: http://modernizr.com/download/#-fontface-opacity-cssanimations-generatedcontent-cssgradients-csstransforms-csstransforms3d-csstransitions-input-inputtypes-touch-shiv-cssclasses-teststyles-testprop-testallprops-hasevent-prefixes-domprefixes-forms_placeholder */
;window.Modernizr=function(a,b,c){function B(a){j.cssText=a}function C(a,b){return B(n.join(a+";")+(b||""))}function D(a,b){return typeof a===b}function E(a,b){return!!~(""+a).indexOf(b)}function F(a,b){for(var d in a){var e=a[d];if(!E(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function G(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:D(f,"function")?f.bind(d||b):f}return!1}function H(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return D(b,"string")||D(b,"undefined")?F(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),G(e,b,c))}function I(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)t[c[d]]=c[d]in k;return t.list&&(t.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),t}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),s[a[d]]=!!e;return s}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={},s={},t={},u=[],v=u.slice,w,x=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},y=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=D(e[d],"function"),D(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),z={}.hasOwnProperty,A;!D(z,"undefined")&&!D(z.call,"undefined")?A=function(a,b){return z.call(a,b)}:A=function(a,b){return b in a&&D(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=v.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(v.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(v.call(arguments)))};return e}),r.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:x(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},r.opacity=function(){return C("opacity:.55"),/^0.55$/.test(j.opacity)},r.cssanimations=function(){return H("animationName")},r.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return B((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),E(j.backgroundImage,"gradient")},r.csstransforms=function(){return!!H("transform")},r.csstransforms3d=function(){var a=!!H("perspective");return a&&"webkitPerspective"in g.style&&x("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},r.csstransitions=function(){return H("transition")},r.fontface=function(){var a;return x('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},r.generatedcontent=function(){var a;return x(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a};for(var J in r)A(r,J)&&(w=J.toLowerCase(),e[w]=r[J](),u.push((e[w]?"":"no-")+w));return e.input||I(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)A(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},B(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.hasEvent=y,e.testProp=function(a){return F([a])},e.testAllProps=H,e.testStyles=x,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+u.join(" "):""),e}(this,this.document),Modernizr.addTest("placeholder",function(){return"placeholder"in(Modernizr.input||document.createElement("input"))&&"placeholder"in(Modernizr.textarea||document.createElement("textarea"))});
/* Custom :checked code */ Modernizr.addTest('csschecked', function () { return Modernizr.testStyles("#modernizr input {margin-left:0px;} #modernizr input:checked {margin-left: 20px;}", function (elem) { var chx = document.createElement('input'); chx.type = "checkbox"; chx.checked = "checked";elem.appendChild(chx);return elem.lastChild.offsetLeft >= 20;});});
/* jQuery Validation Plugin 1.9.0 | http://bassistance.de/jquery-plugins/jquery-plugin-validation/ | http://docs.jquery.com/Plugins/Validation* * Copyright (c) 2006 - 2011 JÃ¶rn Zaefferer */
(function($){$.extend($.fn,{validate:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var validator=$.data(this[0],'validator');if(validator){return validator}this.attr('novalidate','novalidate');validator=new $.validator(options,this[0]);$.data(this[0],'validator',validator);if(validator.settings.onsubmit){var inputsAndButtons=this.find("input, button");inputsAndButtons.filter(".cancel").click(function(){validator.cancelSubmit=true});if(validator.settings.submitHandler){inputsAndButtons.filter(":submit").click(function(){validator.submitButton=this})}this.submit(function(event){if(validator.settings.debug)event.preventDefault();function handle(){if(validator.settings.submitHandler){if(validator.submitButton){var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm)}validator.settings.submitHandler.call(validator,validator.currentForm);if(validator.submitButton){hidden.remove()}return false}return true}if(validator.cancelSubmit){validator.cancelSubmit=false;return handle()}if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false}return handle()}else{validator.focusInvalid();return false}})}return validator},valid:function(){if($(this[0]).is('form')){return this.validate().form()}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid&=validator.element(this)});return valid}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value)});return result},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,'validator').settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));staticRules[element.name]=existingRules;if(argument.messages)settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);break;case"remove":if(!argument){delete staticRules[element.name];return existingRules}var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method]});return filtered}}var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data)}return data}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+a.value)},filled:function(a){return!!$.trim(""+a.value)},unchecked:function(a){return!a.checked}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init()};$.validator.format=function(source,params){if(arguments.length==1)return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args)};if(arguments.length>2&&params.constructor!=Array){params=$.makeArray(arguments).slice(1)}if(params.constructor!=Array){params=[params]}$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n)});return source};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(element,event){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(element)).hide()}},onfocusout:function(element,event){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element)}},onkeyup:function(element,event){if(element.name in this.submitted||element==this.lastElement){this.element(element)}},onclick:function(element,event){if(element.name in this.submitted)this.element(element);else if(element.parentNode.name in this.submitted)this.element(element.parentNode)},highlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).addClass(errorClass).removeClass(validClass)}else{$(element).addClass(errorClass).removeClass(validClass)}},unhighlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).removeClass(errorClass).addClass(validClass)}else{$(element).removeClass(errorClass).addClass(validClass)}}},setDefaults:function(settings){$.extend($.validator.defaults,settings)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={});$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key})});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value)});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");validator.settings[eventType]&&validator.settings[eventType].call(validator,this[0],event)}$(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, "+"[type='number'], [type='search'] ,[type='tel'], [type='url'], "+"[type='email'], [type='datetime'], [type='date'], [type='month'], "+"[type='week'], [type='time'], [type='datetime-local'], "+"[type='range'], [type='color'] ","focusin focusout keyup",delegate).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",delegate);if(this.settings.invalidHandler)$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid())$(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i])}return this.valid()},element:function(element){element=this.validationTargetFor(this.clean(element));this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element);if(result){delete this.invalid[element.name]}else{this.invalid[element.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return result},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]})}this.successList=$.grep(this.successList,function(element){return!(element.name in errors)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if($.fn.resetForm)$(this.currentForm).resetForm();this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(obj){var count=0;for(var i in obj)count++;return count},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name==lastActive.name}).length==1&&lastActive},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in rulesCache||!validator.objectLength($(this).rules()))return false;rulesCache[this.name]=true;return true})},clean:function(selector){return $(selector)[0]},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element)},check:function(element){element=this.validationTargetFor(this.clean(element));var rules=$(element).rules();var dependencyMismatch=false;for(var method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if(result=="dependency-mismatch"){dependencyMismatch=true;continue}dependencyMismatch=false;if(result=="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return}if(!result){this.formatAndAdd(element,rule);return false}}catch(e){this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id+", check the '"+rule.method+"' method",e);throw e}}if(dependencyMismatch)return;if(this.objectLength(rules))this.successList.push(element);return true},customMetaMessage:function(element,method){if(!$.metadata)return;var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method]},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method])},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined)return arguments[i]}return undefined},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>")},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message=="function"){message=message.call(this,rule.parameters,element)}else if(theregex.test(message)){message=jQuery.format(message.replace(theregex,'{$1}'),rule.parameters)}this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message},addWrapper:function(toToggle){if(this.settings.wrapper)toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));return toToggle},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);this.showLabel(error.element,error.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var i=0;this.successList[i];i++){this.showLabel(this.successList[i])}}if(this.settings.unhighlight){for(var i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return $(this.errorList).map(function(){return this.element})},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass(this.settings.validClass).addClass(this.settings.errorClass);label.attr("generated")&&label.html(message)}else{label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:true}).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(label).length)this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element)}if(!message&&this.settings.success){label.text("");typeof this.settings.success=="string"?label.addClass(this.settings.success):this.settings.success(label)}this.toShow=this.toShow.add(label)},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr('for')==name})},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name)},validationTargetFor:function(element){if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0]}return element},checkable:function(element){return/radio|checkbox/i.test(element.type)},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null})},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case'select':return $("option:selected",element).length;case'input':if(this.checkable(element))return this.findByName(element.name).filter(':checked').length}return value.length},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true},dependTypes:{"boolean":function(param,element){return param},"string":function(param,element){return!!$(param,element.form).length},"function":function(param,element){return param(element)}},optional:function(element){return!$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch"},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0)this.pendingRequest=0;delete this.pending[element.name];if(valid&&this.pendingRequest==0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false}else if(!valid&&this.pendingRequest==0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){className.constructor==String?this.classRuleSettings[className]=rules:$.extend(this.classRuleSettings,className)},classRules:function(element){var rules={};var classes=$(element).attr('class');classes&&$.each(classes.split(' '),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this])}});return rules},attributeRules:function(element){var rules={};var $element=$(element);for(var method in $.validator.methods){var value;if(method==='required'&&typeof $.fn.prop==='function'){value=$element.prop(method)}else{value=$element.attr(method)}if(value){rules[method]=value}else if($element[0].getAttribute("type")===method){rules[method]=true}}if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength}return rules},metadataRules:function(element){if(!$.metadata)return{};var meta=$.data(element.form,'validator').settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata()},staticRules:function(element){var rules={};var validator=$.data(element.form,'validator');if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{}}return rules},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return}if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break}if(keepRule){rules[prop]=val.param!==undefined?val.param:true}else{delete rules[prop]}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter});$.each(['minlength','maxlength','min','max'],function(){if(rules[this]){rules[this]=Number(rules[this])}});$.each(['rangelength','range'],function(){if(rules[this]){rules[this]=[Number(rules[this][0]),Number(rules[this][1])]}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max}if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength}}if(rules.messages){delete rules.messages}return rules},normalizeRule:function(data){if(typeof data=="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true});data=transformed}return data},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!=undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name))}},methods:{required:function(value,element,param){if(!this.depend(param,element))return"dependency-mismatch";switch(element.nodeName.toLowerCase()){case'select':var val=$(element).val();return val&&val.length>0;case'input':if(this.checkable(element))return this.getLength(value,element)>0;default:return $.trim(value).length>0}},remote:function(value,element,param){if(this.optional(element))return"dependency-mismatch";var previous=this.previousValue(element);if(!this.settings.messages[element.name])this.settings.messages[element.name]={};previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param=="string"&&{url:param}||param;if(this.pending[element.name]){return"pending"}if(previous.old===value){return previous.valid}previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);validator.showErrors()}else{var errors={};var message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.showErrors(errors)}previous.valid=valid;validator.stopRequest(element,valid)}},param));return"pending"},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1])},min:function(value,element,param){return this.optional(element)||value>=param},max:function(value,element,param){return this.optional(element)||value<=param},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1])},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(value)},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value)},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value))},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value)},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value)},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value)},creditcard:function(value,element){if(this.optional(element))return"dependency-mismatch";if(/[^0-9 -]+/.test(value))return false;var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);var nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9)nDigit-=9}nCheck+=nDigit;bEven=!bEven}return(nCheck%10)==0},accept:function(value,element,param){param=typeof param=="string"?param.replace(/,/g,'|'):"png|jpe?g|gif";return this.optional(element)||value.match(new RegExp(".("+param+")$","i"))},equalTo:function(value,element,param){var target=$(param).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid()});return value==target.val()}}});$.format=$.validator.format})(jQuery);(function($){var pendingRequests={};if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort()}pendingRequests[port]=xhr}})}else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort()}return(pendingRequests[port]=ajax.apply(this,arguments))}return ajax.apply(this,arguments)}}})(jQuery);(function($){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){$.each({focus:'focusin',blur:'focusout'},function(original,fix){$.event.special[fix]={setup:function(){this.addEventListener(original,handler,true)},teardown:function(){this.removeEventListener(original,handler,true)},handler:function(e){arguments[0]=$.event.fix(e);arguments[0].type=fix;return $.event.handle.apply(this,arguments)}};function handler(e){e=$.event.fix(e);e.type=fix;return $.event.handle.call(this,e)}})};$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments)}})}})})(jQuery);
/* jQuery Placeholder 1.1.9 | Copyright (c) 2010 Michael J. Ryan (http://tracker1.info/) */
(function($){var ph="PLACEHOLDER-INPUT";var phl="PLACEHOLDER-LABEL";var boundEvents=false;var default_options={labelClass:'placeholder'};var input=document.createElement("input");if('placeholder'in input){$.fn.placeholder=$.fn.unplaceholder=function(){};delete input;return};delete input;$(window).resize(checkResize);$.fn.placeholder=function(options){bindEvents();var opts=$.extend(default_options,options);this.each(function(){var rnd=Math.random().toString(32).replace(/\./,''),input=$(this),label=$('<label style="position:absolute;display:none;top:0;left:0;"></label>');if(!input.attr('placeholder')||input.data(ph)===ph)return;if(!input.attr('id'))input.attr('id','input_'+rnd);label.attr('id',input.attr('id')+"_placeholder").data(ph,'#'+input.attr('id')).attr('for',input.attr('id')).addClass(opts.labelClass).addClass(opts.labelClass+'-for-'+this.tagName.toLowerCase()).addClass(phl).text(input.attr('placeholder'));input.data(phl,'#'+label.attr('id')).data(ph,ph).addClass(ph).after(label);itemFocus.call(this);itemBlur.call(this)})};$.fn.unplaceholder=function(){this.each(function(){var input=$(this),label=$(input.data(phl));if(input.data(ph)!==ph)return;label.remove();input.removeData(ph).removeData(phl).removeClass(ph).unbind('change',itemChange)})};function bindEvents(){if(boundEvents)return;$("form").live('reset',function(){$(this).find('.'+ph).each(itemBlur)});$('.'+ph).live('keydown',itemFocus).live('mousedown',itemFocus).live('mouseup',itemFocus).live('mouseclick',itemFocus).live('focus',itemFocus).live('focusin',itemFocus).live('blur',itemBlur).live('focusout',itemBlur).live('change',itemChange);$('.'+phl).live('click',function(){$($(this).data(ph)).focus()}).live('mouseup',function(){$($(this).data(ph)).focus()});bound=true;boundEvents=true};function itemChange(){var input=$(this);if(!!input.val()){$(input.data(phl)).hide();return}if(input.data(ph+'FOCUSED')!=1){showPHL(input)}}function itemFocus(){$($(this).data(ph+'FOCUSED',1).data(phl)).hide()};function itemBlur(){var that=this;showPHL($(this).removeData(ph+'FOCUSED'));setTimeout(function(){var input=$(that);if(input.data(ph+'FOCUSED')!=1){showPHL(input)}},200)};function showPHL(input,forced){var label=$(input.data(phl));if((forced||label.css('display')=='none')&&!input.val())label.text(input.attr('placeholder')).css('top',input.position().top+'px').css('left',input.position().left+'px').css('display','block')}var cr;function checkResize(){if(cr)window.clearTimeout(cr);cr=window.setTimeout(checkResize2,50)}function checkResize2(){$('.'+ph).each(function(){var input=$(this);var focused=$(this).data(ph+'FOCUSED');if(!focused)showPHL(input,true)})}}(jQuery));
/** https://github.com/Kicksend/mailcheck/ **/
var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(a){a.domains=a.domains||Kicksend.mailcheck.defaultDomains;a.topLevelDomains=a.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains;a.distanceFunction=a.distanceFunction||Kicksend.sift3Distance;var b=Kicksend.mailcheck.suggest(encodeURI(a.email),a.domains,a.topLevelDomains,a.distanceFunction);b?a.suggested&&a.suggested(b):a.empty&&a.empty()},suggest:function(a,b,c,d){a=a.toLowerCase();a=this.splitEmail(a);if(b=this.findClosestDomain(a.domain,b,d)){if(b!=a.domain)return{address:a.address,domain:b,full:a.address+"@"+b}}else if(c=this.findClosestDomain(a.topLevelDomain,c),a.domain&&c&&c!=a.topLevelDomain)return b=a.domain,b=b.substring(0,b.lastIndexOf(a.topLevelDomain))+c,{address:a.address,domain:b,full:a.address+"@"+b};return!1},findClosestDomain:function(a,b,c){var d,e=99,g=null;if(!a||!b)return!1;c||(c=this.sift3Distance);for(var f=0;f<b.length;f++){if(a===b[f])return a;d=c(a,b[f]);d<e&&(e=d,g=b[f])}return e<=this.threshold&&null!==g?g:!1},sift3Distance:function(a,b){if(null==a||0===a.length)return null==b||0===b.length?0:b.length;if(null==b||0===b.length)return a.length;for(var c=0,d=0,e=0,g=0;c+d<a.length&&c+e<b.length;){if(a.charAt(c+d)==b.charAt(c+e))g++;else for(var f=e=d=0;5>f;f++){if(c+f<a.length&&a.charAt(c+f)==b.charAt(c)){d=f;break}if(c+f<b.length&&a.charAt(c)==b.charAt(c+f)){e=f;break}}c++}return(a.length+b.length)/2-g},splitEmail:function(a){a=a.split("@");if(2>a.length)return!1;for(var b=0;b<a.length;b++)if(""===a[b])return!1;var c=a.pop(),d=c.split("."),e="";if(0==d.length)return!1;if(1==d.length)e=d[0];else{for(b=1;b<d.length;b++)e+=d[b]+".";2<=d.length&&(e=e.substring(0,e.length-1))}return{topLevelDomain:e,domain:c,address:a.join("@")}}}};window.jQuery&&function(a){a.fn.mailcheck=function(a){var c=this;if(a.suggested){var d=a.suggested;a.suggested=function(a){d(c,a)}}if(a.empty){var e=a.empty;a.empty=function(){e.call(null,c)}}a.email=this.val();Kicksend.mailcheck.run(a)}}(jQuery);


ehcorp.reg = {
  $forms : [],
  init : function(){
    // Load $.browser plugin in case $ version is < 1.9
    if (typeof $.browser === 'undefined') {
        $.getScript('http://static.eharmony.com/files/corp/js/lib/jquery.browser.min.js');
    }

    //This adds the form to be available everywhere
    this.$forms = $('form.registration');
    this.formbuilder.init();//Find all forms, finish building them
    this.gender.init(); //Setup the gender stuff
    this.validate.init();//Find all forms, setup validation of them
    this.tracking.init(); //Setup tracking on forms
  }
};

//GA Tracking by homepage
ehcorp.reg.tracking = {
  init: function(){
    $('input,select',ehcorp.reg.$forms).focusin(function(){
      var element_name = this.name + ':' + this.type;
      $(window).trigger('form:engagement',element_name);
    });
    $(window).bind('form:engagement',this.trackFormEngagement);
  },
  trackRegForm : function(type){
    var url = window.location.href,
        url_section = function(x){ return (x != "" && x!='/'); },
        path_array = $.grep(window.location.pathname.split('/'),url_section),
        site_section = path_array.length <= 1 ? 'root' : path_array.shift();
    this.trackEvent('Singles Reg Form',site_section,url);
  },
  trackFormEngagement : function(evt,element_name)
  {
    var formstyle = ehcorp.reg.$forms.data('formstyle') || 'standard';
    ehcorp.reg.tracking.trackEvent('Corp::RegForm Engagement','style:'+formstyle, element_name);
  },

  /**
   * trackEvent('Singles RegForm','root');
  */
  trackEvent : function(category,action,label,value)
  {
    //Analytics custom link tracking
    if (typeof _gaq != "undefined" && typeof _gat != "undefined" && typeof _gat._getTrackerByName != "undefined" ) {
      var pageTracker = _gat._getTrackerByName();
      pageTracker._trackEvent(category,action,label,value);
    }
  }
};

ehcorp.reg.formbuilder = {
  init : function(){
    this.create_placeholders();
    this.add_landing_page_to_form();
    this.set_form_action();
    this.shuffle_eh_find_values();
    this.create_form_seals();
    this.setup_overlay();
    this.add_query_params_to_form();
    this.load_countries();
  },
  load_countries: function(){
    var that = this;
    this.countries = {}; 
    $.getJSON('http://www.eharmony.com/lane/countrydata.php',function(data){
        that.countries = data.countries;
        that.ipcountry = data.ipcountry;
        that.create_country_dropdown();
    });
  },
  /**
   * Create the dropdown. Just using a literal string for speed
   */
  create_country_dropdown: function () {
    var literalOptions = '', selectedCountry, country;
    for(var code in this.countries){
        country = this.countries[code];
        if(code == this.ipcountry){
            selectedCountry = country.id;
        }
        literalOptions += '<option value="' + country.id + '">' + country.name + '</option>'; 
    }
    //First add the countries
    $("select[name=country]", ehcorp.reg.$forms).append(literalOptions).val(selectedCountry);

    //Select the country
    var countrySelector =  ehcorp.locale.key;
	if(ehcorp.locale.ids.hasOwnProperty(countrySelector)) {
		$('[name=country]').val(ehcorp.locale.ids[countrySelector]);
	}
  },
  create_placeholders : function(){
    //Only do placeholders on visible forms
    $('input[placeholder]').filter(':visible').placeholder();
  },
  setup_overlay : function() {
    /* Overlay for when the form gets focus*/
    var show_overlay = function(){
      $('#pageoverlay').show();
      if(typeof $.unblockUI == 'function')
      {
        $.unblockUI();
      }
      $('.regform').css('background-color','#eeeeee');
    };
    var hide_overlay = function() { $('#pageoverlay').hide(); $('.regform').css('background-color','');};
    $('input, select',ehcorp.reg.$forms).focusin(show_overlay);
    $('#genders label',ehcorp.reg.$forms).click(show_overlay);
    $('#pageoverlay').click(hide_overlay);
  },

  /**
   * Add the various query parameters to the reg form
   */
  add_query_params_to_form: function () {
    var query_params = ehcorp.GET;

    //Remove password if it's passed in.
    if(query_params.password) { delete(query_params.password); }

    //For each of the query parameters
    for ( key in query_params )
    {
      value = query_params[key];
      if(typeof(value) === 'string')  //Only set the parameter if the value is a string, no booleans or nulls
      {
        if ($(" [name="+key+"]", ehcorp.reg.$forms).length) {
          $(" [name="+key+"]", ehcorp.reg.$forms).val(value);
        } else {
          ehcorp.reg.$forms.append("<input type='hidden' name='" + key + "' value='" + value + "' />");
        }
      }
    }
  },

  /**
   * Make sure the form action matches the locale
   */
  set_form_action: function () {
    // If locale exists, force appropriate form action URL.  Otherwise, leave as defined in document.
    if (ehcorp.locale.submitDomain() !== "")
    {
      var action_url = "https://" + ehcorp.locale.submitDomain() + "/singles/servlet/homeRegS";
      //Set all actions to the proper locale
      ehcorp.reg.$forms.attr('action',action_url);
    }
  },
  /**
   * Shuffle the found eh values to not skew results
   */
  shuffle_eh_find_values: function () {
    var find_eh_len = $("select[name=findEH]", ehcorp.reg.$forms).length;
    if (find_eh_len)
    {
      //Go thru each of the select elements
      for(var i = 0; i<find_eh_len; i++)
      {
        // Select all the findEH options (except "Please select...")
        var options = $("select[name=findEH] option", ehcorp.reg.$forms[i]).not(":eq(0)"),
          tempHTML, tempValue,randomNumber;

        options.each(function () {
          // Choose a random option
          randomNumber = Math.floor(Math.random() * 16) % options.length;

          // Then swap HTML and values with that random option.
          tempHTML = $(this).html();
          tempValue = $(this).val();

          $(this).html(options.eq(randomNumber).html());
          $(this).val(options.eq(randomNumber).val());

          options.eq(randomNumber).html(tempHTML);
          options.eq(randomNumber).val(tempValue);
        });
      }
    }
  },

  /**
   * Track what page this was on
   */
  add_landing_page_to_form: function ()
  {
    var landingPageTrackingValue = '';

    if (landingPageTrackingValue === '' && typeof sbms !== 'undefined' && typeof sbms.parent !== 'undefined' && typeof sbms.page !== 'undefined')
    {
      landingPageTrackingValue = sbms.parent + '-' + sbms.page;
    }

    if(landingPageTrackingValue === '')
    {
      landingPageTrackingValue = document.location.pathname;
    }

    // Truncate if it exceeds the 30 character limit set in the database
    if (landingPageTrackingValue.length >= 30)
    {
      landingPageTrackingValue = landingPageTrackingValue.substring(0,29);
    }

    // Set it to the landingPage hidden input field, or append it to the reg form if there isn't one
    if ($("input[name=landingPage]", ehcorp.reg.$forms).length)
    {
      $("input[name=landingPage]", ehcorp.reg.$forms).val(landingPageTrackingValue);
    }
    else
    {
      ehcorp.reg.$forms.append('<input type="hidden" name="landingPage" value="' + landingPageTrackingValue + '" />');
    }
  },
  create_form_seals: function () {
    var sealsHtml = "<ul>";

    if (window.location.pathname.length <= 1) {
      sealsHtml += '<li class="first truste"><a href="//privacy.truste.com/privacy-seal/validation?rid=03d7652a-aa71-46ad-9979-65ca69939af9" target="_blank"><img style="border: none" src="//privacy-policy.truste.com/privacy-seal/seal?rid=03d7652a-aa71-46ad-9979-65ca69939af9" alt="TRUSTe"/></a></li>';
    }
    sealsHtml += '<li><a href="http://www.bbb.org/losangelessiliconvalley/business-reviews/dating-service-online/eharmony-in-santa-monica-ca-13109297" target="_blank" onclick="launchPopupFlag=false;"><img src="http://static.eharmony.com:80/static/images/home/bbb.gif" height="31" width="90" border="0" vspace="8" alt="BBB" /></a></li>';
    sealsHtml += '<li class="last"><iframe scrolling="no" frameborder="0" id="seals-iframe" name="seals-iframe" src="http://www.eharmony.com/assets/corp/tabs0610/verisign.html" /></li></ul>';
    $('.form-seals, #form-seals').html(sealsHtml);
  }
};

ehcorp.reg.validate = {
  validators : [],
  init : function(){
    jQuery.validator.addMethod("validPostalCode", function(value, element, param) {

        var countryInput = $('select[name="country"]'),
            selectedCountry = countryInput.val(),
            countries = ehcorp.reg.formbuilder.countries,
            country, code, regex;

        //Only validate the postal code if the country is valid
        if(!countryInput.hasClass('valid')){
            return true;
        }
        for(code in countries){ 
            country = countries[code];
            if(country.id == selectedCountry){ 
                if(country.regex === ''){
                    //$(element).attr('placeholder','N/A');
                    return true;
                } else {
                    regex = new RegExp('^' + country.regex + '$', 'i');
                    return regex.test(value);    
                }
                
            } 
        }
    }, "Invalid format.");

    ehcorp.reg.$forms.each(function(i,el){
      var this_ruleset = ehcorp.reg.validate.rules;
      this_ruleset.confirmEmail.equalTo = $(el).find('[name=emailAddress]');
      ehcorp.reg.validate.validators[i] = $(el).validate({
        errorClass : 'invalid',
        rules : this_ruleset,
        messages : ehcorp.reg.validate.messages,
        errorPlacement : ehcorp.reg.validate.errorPlacement,
        submitHandler : ehcorp.reg.validate.submitHandler,
        success : ehcorp.reg.validate.success
      });
      $(el).find('input,select').blur(function(a){
        $(el).validate().element(this);
      });
      $(el).find('select').change(function(a){
        $(el).validate().element(this);
      });
    });
  },
  messages :  {
    firstName: "Enter your first name only",
    gender : "Select your gender",
    gender2 : "Select gender preference",
    country : "Enter the country you live in",
    password: {
      required: "Provide a password",
      rangelength: $.validator.format("Enter at least {0} characters")
    },
    confirmEmail: {
      required: "Repeat your email",
      minlength:  $.validator.format("Enter at least {0} characters"),
      equalTo: "Enter the same email as above"
    },
    emailAddress: {
      required: "Enter a valid email address",
      minlength: "Please enter a valid email address"
    },
    postalCode : {
      validPostalCode  : "Invalid Postal Code"
    },
    findEH : "Select how you found out about eHarmony",
    terms : "Please select that you have read our Terms and Conditions"
  },
  rules : {
    firstName : "required",
    gender : {
      required : true,
      min : 1
    },
    gender2 : {
      required : true,
      min : 1
    },
    country : {
      required : true,
      min : 1
    },
    password : {
      required : true,
      minlength : 8,
      maxlength: 14
    },
    emailAddress : {
      required : true,
      email : true
    },
    confirmEmail : {
      required : true,
      email : true
    },
    postalCode : {
      validPostalCode: true
    },
    findEH : "required"
  },
  errorPlacement: function(error, element) {
    //For select elements, we need to add the invalid class to the parent.
    var section = element.closest('div:not(.text),section');
    if(element.is('select') && element.hasClass('invalid'))
    {
      section.addClass('invalid');
    }

    //If there is a tip in the nearest section, or non-text div, we use it, otherwise just append it to the element
    if(section.find('.tip').length)
    {
      section.find('.tip').html('').removeClass('notice');
      error.appendTo( section.find('.tip') );
    }
    else
    {
      //Create the element for the error label
      $('<span class="tip"></span>').html(error).insertAfter(element);
    }
  },
  // specifying a submitHandler prevents the default submit, good for the demo
  submitHandler: function(form) {

    var g1 = $('[name=gender]:checked',form).val(),
        g2 = $('[name=gender2]:checked',form).val();

    if(g1 !== g2)
    {
      ehcorp.reg.gender.launchOverlay(form);
      return false;
    }
    else
    {
      ehcorp.reg.tracking.trackRegForm();
      $('form[name="registrationForm"] input[type=submit]').attr('disabled', 'disabled');
      /*SWT-7921: Required to prevent login issues*/
      if (ehcorp.deviceID) {
        ehcorp.deviceID.deleteSessionCookies();
        ehcorp.deviceID.set_deviceid_cookie();
      }
      form.submit();
    }
    return true;
  },
  // set this class to error-labels to indicate valid fields
  success: function(label) {
    //section is the container box
    var section = $(label).closest('div:not(.text),section');

    //Remove the label and spans we used.
    label.remove();
    section.find('span.tip').remove();

    //if the input is valid, make the box valid too
    if(section.find('select').hasClass('valid'))
    {
      section.find('.text').removeClass('invalid').addClass('valid');
    }

    var element = section.find('input,select');

    //Add mailcheck support in.
    if(element.attr('type') == 'email' || element.attr('name') == 'emailAddress')
    {
      //We dont have a confirmEmail address form element, so we need to fake it.
      var email = $('input[name=emailAddress]',ehcorp.reg.$forms).val();
      $('input[name=confirmEmail]',ehcorp.reg.$forms).val(email);

      $(element).mailcheck({
        suggested: function(el, suggestion) {
          // callback code
          if($(el).hasClass('valid') && $(el).parent().find('span.tip.notice').length == 0)
          {
            $('<span class="tip notice"></span>').html('<label>Did you mean <a>'+suggestion.address+'@'+suggestion.domain+'</a>?</label>').insertAfter(el);
            $('span.notice label a').click(function(){var fill = $(this).html(); $(el).val(fill); $(el).parent().find('span.tip.notice').remove();});
          }
        },
        empty: function(el) {
          //Delete those tips we added
          if($(el).parent().find('span.tip.notice').length > 0)
          {
            $(el).parent().find('span.tip.notice').remove();
          }
        }
      });
    }
  }
};

/**
 * Add parameters to a form
 * @type {Object}
 */
ehcorp.extraParams = {

    /**
     * Delete element from the DOM
     * @method deleteFieldbyName
     * @param  {String}    field The name
     * @return {[type]}
     */
    deleteFieldbyName: function (field) {
        var elem = document.getElementsByName(field)[0];
        elem.parentNode.removeChild(elem);
    },
    /**
     * Return a parameter from a form
     * @method getParameter
     * @param  {Object}     form            The form
     * @param  {}           paramName       The param to be returned
     * @param {Boolean}     deleteParam     Delete the parameter
     * @return {String}
     */
    getParameter: function (form, paramName) {
        var result,
            serializedResults;

        if (!(form instanceof $)) {
            form = $(form);
        }

        serializedResults = form.serializeArray();

        for (var element in serializedResults) {
            if (serializedResults[element].name === paramName) {
                return serializedResults[element].value;
            };
        }
        return false;
    },
    /**
     * Add extra parameters to the form
     * @method addExtraParameter
     * @param  {Object} form        the form to be updated
     * @param  {String} name        the input name
     * @param  {String} value       the input value
     * @return {Object} The modified form
     */
    addExtraParameter : function (form, name, value) {
        var newElement   = document.createElement('input');
        newElement.type  = 'hidden';
        newElement.name  = name;
        newElement.value = value;

        form.appendChild(newElement);
        return form;
    },
    /**
     * Delete old input in the form and create a new one
     * with the new value
     * @method switchParameters
     * @param  {Object}         form      form element to return with the new value
     * @param  {String}         paramName name of the element to delete & create
     * @param  {String}         newValue  The new value of the new element
     * @return {Object}
     */
    switchParameters: function (form, paramName, newValue) {
        var newElement   = document.createElement('input');

        // Delete old field
        this.deleteFieldbyName(paramName);

        // Create new element with the new value
        newElement.type  = 'hidden';
        newElement.name  = paramName;
        newElement.value = newValue;

        form.appendChild(newElement);
        return form;
    }
};

ehcorp.reg.gender = {
  init : function(){
    $('#genders label').click(function(){
      var htmlFor = this.htmlFor,
      labelGroup  = $(this).hasClass('iam') ? 'iam' : 'seek';
      if(!Modernizr.csschecked) //Stupid IE can't handle the :checked css
      {
        //Uncheck all the labels for this input, IE can't handle adjacent css stuff. Sigh.
        $('#genders label.'+labelGroup+'').removeClass('checked');
        //Add the checked class for this specific label
        $(this).addClass('checked');
      }

      //If this is the label for the "I'm a" part, click the appropriate other label.
      if(labelGroup == 'iam')
      {
        var other_label = htmlFor == 'am-woman' ? 'seek-man' : 'seek-woman';
        $('#genders label[for='+other_label+']').click();
        $('#genders #'+other_label)[0].checked=true;
      }

      //Completely unrelated to the clicking and switch, trigger the form engagement
      var which_gender = /woman/.test(this.className) ? 'woman' : 'man',
          element_name = 'gender:' + which_gender;
      $(window).trigger('form:engagement',element_name);
    });
  },
  options: {
    // US, CA, UK, AU | default values
    overlayMarkup: '<h2>Would you like to go to</h2><h1>Compatible Partners?</h1><p>Welcome to eHarmony&#8217;s gay and lesbian dating page, <b>Compatible Partners</b>, an eHarmony service for gay and lesbian singles seeking long term relationships.</p><button class="btn-cancel"><span>x</span></button><button class="btn-confirm"><span>Go to Compatible Partners</span></button>',
    overlaySelector: "cp_confirm",
    genderField: "gender2",
    redirectUrl: "http://www.compatiblepartners.net/eHarmony/?cid=61953&"
  },
  createOverlay: function (form) {
    var options = ehcorp.reg.gender.options;
    var genderOverlay = $('<div class="gender-overlay" id="'+options.overlaySelector+'"></div>').html(options.overlayMarkup).dialog({
      closeText: '',
      modal:true,
      height:211,
      width: 472
    });

    //Continue Button
    $(".gender-overlay .btn-confirm").click(function () {
      // Do submit to the new location
      // SWT-6127
      
      // Get the gender2 value
      var genderValue = ehcorp.extraParams.getParameter(form, 'gender2');

      // Add the new value to the form
      form = ehcorp.extraParams.addExtraParameter(form, 'genderPreference', genderValue);

      // Delete the extra inputs
      ehcorp.extraParams.deleteFieldbyName('gender2');

      // Change the genderinput values according to the CP regForm
      // 1 === 'men'
      // 2 === 'women'
      if (genderValue == 1) {
        form = ehcorp.extraParams.switchParameters(form, 'gender', 2);
        form = ehcorp.extraParams.switchParameters(form, 'genderPreference', 2);
      } else if (genderValue == 2) {
        form = ehcorp.extraParams.switchParameters(form, 'gender', 1);
        form = ehcorp.extraParams.switchParameters(form, 'genderPreference', 1);
      }

      // Change the form action to CP reg backend
      form.action = 'https://www.compatiblepartners.net/singles/servlet/homeRegS';

      $('form[name="registrationForm"] input[type=submit]').attr('disabled', 'disabled');
      /*SWT-7921: Required to prevent login issues*/
      if (ehcorp.deviceID) {
        ehcorp.deviceID.deleteSessionCookies();
        ehcorp.deviceID.set_deviceid_cookie();
      }
      // Submit the form to CP
      form.submit();
    });

    //Cancel Button
    $(".gender-overlay .btn-cancel, .ui-widget-overlay").click(function () {
      genderOverlay.dialog('close');
    });
 },
  launchOverlay: function (form) {
    // Check if JQuery UI is already loaded, and load it if is not
    if (typeof jQuery.ui === "undefined") {
      $.getScript('http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js', function(){
        ehcorp.reg.gender.createOverlay(form);
      });
    } else {
      ehcorp.reg.gender.createOverlay(form);
    }
  }
};


/**
 * Registration Stuff
 * @requires: Jquery, ehcorp
 */
if (typeof jQuery === 'function') {
  //Document on ready
  $(function() {
    ehcorp.reg.init();
    //First, move the seo stuff down in the page.
    //$('.seo').insertBefore('#footer');

    //For touch devices, flip the cards on a click or touch start event
    if(Modernizr.touch) //iPads and the like
    {
      //Functions for toggling flipcard
      $('.flipcard').bind('touchstart MSPointerDown',function(){ $(this).toggleClass('hover'); });

    }
    //For devices that just dont support 3d transforms
    else if(!Modernizr.csstransforms3d)//IE and the like
    {
      //Make the overflow hidden and set the back card to the left
      $('.flipcard-container').css({ overflow: 'hidden' });

      //Functions for toggling flipcard
      var show_back = function(){$('.face.back').css({left: '100%'}); $('.face.front',$(this)).animate({'left':'-100%'});$('.face.back',$(this)).animate({'left':'0'}); }
      var hide_back = function(){$('.face.front',$(this)).animate({'left':'0'});$('.face.back',$(this)).animate({'left':'100%'}); }

      show_back = function(){ $('.face.back').css({marginLeft: '100%'}); $('.face.front',$(this)).animate({'marginLeft':'-100%'});$('.face.back',$(this)).animate({'marginLeft':'0'}); }
      hide_back = function(){ $('.face.front',$(this)).animate({'marginLeft':'0'});$('.face.back',$(this)).animate({'marginLeft':'100%'}); }


      $('.flipcard').bind('mouseenter',show_back);
      $('.flipcard').bind('mouseleave',hide_back);
    }

    // I think we should show the flip at least once.
    var flipOnce3d = function(recur){
      $('.flipcard:eq(0)').toggleClass('hover');
      if(recur)
      {
        setTimeout(flipOnce3d,750,false);
      }
    };
    var flipOnceIE = function(recur)
    {
      var action = recur ? 'mouseenter' : 'mouseleave';
      $('.flipcard:eq(0)').trigger(action);
      if(recur)
      {
        setTimeout(flipOnceIE,750,false);
      }
    }
    var flipOnce = Modernizr.csstransforms3d ? flipOnce3d : flipOnceIE;
    var flip = setTimeout(function(){flipOnce(true)},1500);
  });
}